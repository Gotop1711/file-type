'use strict';var _interopRequireDefault=require("@babel/runtime-corejs3/helpers/interopRequireDefault"),_trim=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/trim")),_startsWith=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/starts-with")),_endsWith=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/ends-with")),_maxSafeInteger=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/number/max-safe-integer")),_includes=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/includes")),_getIterator2=_interopRequireDefault(require("@babel/runtime-corejs3/core-js/get-iterator")),_isArray=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/array/is-array")),_getIteratorMethod2=_interopRequireDefault(require("@babel/runtime-corejs3/core-js/get-iterator-method")),_symbol=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/symbol")),_from=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/array/from")),_slice=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/slice")),_defineProperties=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/object/define-properties")),_getOwnPropertyDescriptors=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptors")),_forEach=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/for-each")),_getOwnPropertyDescriptor=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptor")),_filter=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/filter")),_getOwnPropertySymbols=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/object/get-own-property-symbols")),_keys=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/object/keys")),_typeof2=_interopRequireDefault(require("@babel/runtime-corejs3/helpers/typeof")),_set=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/set")),_defineProperty2=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/object/define-property")),_regenerator=_interopRequireDefault(require("@babel/runtime-corejs3/regenerator")),_promise=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/promise")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime-corejs3/helpers/slicedToArray")),_entries=_interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/entries")),_defineProperty3=_interopRequireDefault(require("@babel/runtime-corejs3/helpers/defineProperty")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime-corejs3/helpers/asyncToGenerator"));function _createForOfIteratorHelper(a){if("undefined"==typeof _symbol["default"]||null==(0,_getIteratorMethod2["default"])(a)){if((0,_isArray["default"])(a)||(a=_unsupportedIterableToArray(a))){var b=0,c=function(){};return{s:c,n:function n(){return b>=a.length?{done:!0}:{done:!1,value:a[b++]}},e:function e(a){throw a},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var d,e,f=!0,g=!1;return{s:function s(){d=(0,_getIterator2["default"])(a)},n:function n(){var a=d.next();return f=a.done,a},e:function e(a){g=!0,e=a},f:function f(){try{f||null==d["return"]||d["return"]()}finally{if(g)throw e}}}}function _unsupportedIterableToArray(a,b){var c;if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var d=(0,_slice["default"])(c=Object.prototype.toString.call(a)).call(c,8,-1);return"Object"===d&&a.constructor&&(d=a.constructor.name),"Map"===d||"Set"===d?(0,_from["default"])(a):"Arguments"===d||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function ownKeys(a,b){var c=(0,_keys["default"])(a);if(_getOwnPropertySymbols["default"]){var d=(0,_getOwnPropertySymbols["default"])(a);b&&(d=(0,_filter["default"])(d).call(d,function(b){return(0,_getOwnPropertyDescriptor["default"])(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)if(b=null==arguments[c]?{}:arguments[c],c%2){var d;(0,_forEach["default"])(d=ownKeys(Object(b),!0)).call(d,function(c){(0,_defineProperty3["default"])(a,c,b[c])})}else if(_getOwnPropertyDescriptors["default"])(0,_defineProperties["default"])(a,(0,_getOwnPropertyDescriptors["default"])(b));else{var e;(0,_forEach["default"])(e=ownKeys(Object(b))).call(e,function(c){(0,_defineProperty2["default"])(a,c,(0,_getOwnPropertyDescriptor["default"])(b,c))})}return a}var Token=require("token-types"),strtok3=require("strtok3/lib/core"),_require=require("./util"),stringToBytes=_require.stringToBytes,tarHeaderChecksumMatches=_require.tarHeaderChecksumMatches,uint32SyncSafeToken=_require.uint32SyncSafeToken,uint8ArrayUtf8ByteString=_require.uint8ArrayUtf8ByteString,supported=require("./supported"),minimumBytes=4100;// A fair amount of file-types are detectable within this range
function fromStream(){return _fromStream.apply(this,arguments)}function _fromStream(){return _fromStream=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b){var c;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,strtok3.fromStream(b);case 2:return c=a.sent,a.prev=3,a.next=6,fromTokenizer(c);case 6:return a.abrupt("return",a.sent);case 7:return a.prev=7,a.next=10,c.close();case 10:return a.finish(7);case 11:case"end":return a.stop();}},a,null,[[3,,7,11]])})),_fromStream.apply(this,arguments)}function fromBuffer(){return _fromBuffer.apply(this,arguments)}function _fromBuffer(){return _fromBuffer=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b){var c,d;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(b instanceof Uint8Array||b instanceof ArrayBuffer||Buffer.isBuffer(b)){a.next=2;break}throw new TypeError("Expected the `input` argument to be of type `Uint8Array` or `Buffer` or `ArrayBuffer`, got `".concat((0,_typeof2["default"])(b),"`"));case 2:if(c=b instanceof Buffer?b:Buffer.from(b),c&&1<c.length){a.next=5;break}return a.abrupt("return");case 5:return d=strtok3.fromBuffer(c),a.abrupt("return",fromTokenizer(d));case 7:case"end":return a.stop();}},a)})),_fromBuffer.apply(this,arguments)}function _check(a,b,c){c=_objectSpread({offset:0},c);var d,e=_createForOfIteratorHelper((0,_entries["default"])(b).call(b));try{for(e.s();!(d=e.n()).done;){var f=(0,_slicedToArray2["default"])(d.value,2),g=f[0],h=f[1];// If a bitmask is set
if(c.mask){// If header doesn't equal `buf` with bits masked off
if(h!==(c.mask[g]&a[g+c.offset]))return!1;}else if(h!==a[g+c.offset])return!1}}catch(a){e.e(a)}finally{e.f()}return!0}function _checkSequence(){return _checkSequence2.apply(this,arguments)}function _checkSequence2(){return _checkSequence2=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b,c,d){var e;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return e=Buffer.alloc(minimumBytes),a.next=3,c.ignore(d);case 3:return a.next=5,c.peekBuffer(e,{mayBeLess:!0});case 5:return a.abrupt("return",(0,_includes["default"])(e).call(e,Buffer.from(b)));case 6:case"end":return a.stop();}},a)})),_checkSequence2.apply(this,arguments)}function fromTokenizer(){return _fromTokenizer2.apply(this,arguments)}function _fromTokenizer2(){return _fromTokenizer2=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b){return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.abrupt("return",_fromTokenizer(b));case 4:if(a.prev=4,a.t0=a["catch"](0),a.t0 instanceof strtok3.EndOfStreamError){a.next=8;break}throw a.t0;case 8:case"end":return a.stop();}},a,null,[[0,4]])})),_fromTokenizer2.apply(this,arguments)}function _fromTokenizer(){return _fromTokenizer3.apply(this,arguments)}function _fromTokenizer3(){return _fromTokenizer3=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;return _regenerator["default"].wrap(function(a){var G=Math.min;for(;;)switch(a.prev=a.next){case 0:return c=Buffer.alloc(minimumBytes),d=12,e=function(a,b){return _check(c,a,b)},f=function(a,b){return e(stringToBytes(a),b)},g=function(a,c){return _checkSequence(a,b,c)},b.fileInfo.size||(b.fileInfo.size=_maxSafeInteger["default"]),a.next=8,b.peekBuffer(c,{length:d,mayBeLess:!0});case 8:if(!e([66,77])){a.next=10;break}return a.abrupt("return",{ext:"bmp",mime:"image/bmp"});case 10:if(!e([11,119])){a.next=12;break}return a.abrupt("return",{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"});case 12:if(!e([120,1])){a.next=14;break}return a.abrupt("return",{ext:"dmg",mime:"application/x-apple-diskimage"});case 14:if(!e([77,90])){a.next=16;break}return a.abrupt("return",{ext:"exe",mime:"application/x-msdownload"});case 16:if(!e([37,33])){a.next=18;break}return a.abrupt("return",{ext:"ps",mime:"application/postscript"});case 18:if(!(e([31,160])||e([31,157]))){a.next=20;break}return a.abrupt("return",{ext:"Z",mime:"application/x-compress"});case 20:if(!e([255,216,255])){a.next=22;break}return a.abrupt("return",{ext:"jpg",mime:"image/jpeg"});case 22:if(!e([73,73,188])){a.next=24;break}return a.abrupt("return",{ext:"jxr",mime:"image/vnd.ms-photo"});case 24:if(!e([31,139,8])){a.next=26;break}return a.abrupt("return",{ext:"gz",mime:"application/gzip"});case 26:if(!e([66,90,104])){a.next=28;break}return a.abrupt("return",{ext:"bz2",mime:"application/x-bzip2"});case 28:if(!f("ID3")){a.next=39;break}return a.next=31,b.ignore(6);case 31:return a.next=33,b.readToken(uint32SyncSafeToken);case 33:if(h=a.sent,!(b.position+h>b.fileInfo.size)){a.next=36;break}return a.abrupt("return",{ext:"mp3",mime:"audio/mpeg"});case 36:return a.next=38,b.ignore(h);case 38:return a.abrupt("return",fromTokenizer(b));case 39:if(!f("MP+")){a.next=41;break}return a.abrupt("return",{ext:"mpc",mime:"audio/x-musepack"});case 41:if(!((67===c[0]||70===c[0])&&e([87,83],{offset:1}))){a.next=43;break}return a.abrupt("return",{ext:"swf",mime:"application/x-shockwave-flash"});case 43:if(!e([71,73,70])){a.next=45;break}return a.abrupt("return",{ext:"gif",mime:"image/gif"});case 45:if(!f("FLIF")){a.next=47;break}return a.abrupt("return",{ext:"flif",mime:"image/flif"});case 47:if(!f("8BPS")){a.next=49;break}return a.abrupt("return",{ext:"psd",mime:"image/vnd.adobe.photoshop"});case 49:if(!f("WEBP",{offset:8})){a.next=51;break}return a.abrupt("return",{ext:"webp",mime:"image/webp"});case 51:if(!f("MPCK")){a.next=53;break}return a.abrupt("return",{ext:"mpc",mime:"audio/x-musepack"});case 53:if(!f("FORM")){a.next=55;break}return a.abrupt("return",{ext:"aif",mime:"audio/aiff"});case 55:if(!e([80,75,3,4])){a.next=102;break}a.prev=56;case 57:if(!(b.position+30<b.fileInfo.size)){a.next=95;break}return a.next=60,b.readBuffer(c,{length:30});case 60:return l={compressedSize:c.readUInt32LE(18),uncompressedSize:c.readUInt32LE(22),filenameLength:c.readUInt16LE(26),extraFieldLength:c.readUInt16LE(28)},a.next=63,b.readToken(new Token.StringType(l.filenameLength,"utf-8"));case 63:return l.filename=a.sent,a.next=66,b.ignore(l.extraFieldLength);case 66:if("META-INF/mozilla.rsa"!==l.filename){a.next=68;break}return a.abrupt("return",{ext:"xpi",mime:"application/x-xpinstall"});case 68:if(!((0,_endsWith["default"])(i=l.filename).call(i,".rels")||(0,_endsWith["default"])(j=l.filename).call(j,".xml"))){a.next=78;break}m=l.filename.split("/")[0],a.t0=m,a.next="_rels"===a.t0?73:"word"===a.t0?74:"ppt"===a.t0?75:"xl"===a.t0?76:77;break;case 73:return a.abrupt("break",78);case 74:return a.abrupt("return",{ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});case 75:return a.abrupt("return",{ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"});case 76:return a.abrupt("return",{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});case 77:return a.abrupt("break",78);case 78:if(!(0,_startsWith["default"])(k=l.filename).call(k,"xl/")){a.next=80;break}return a.abrupt("return",{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});case 80:if("mimetype"!==l.filename||l.compressedSize!==l.uncompressedSize){a.next=91;break}return a.next=83,b.readToken(new Token.StringType(l.compressedSize,"utf-8"));case 83:n=a.sent,a.t1=n,a.next="application/epub+zip"===a.t1?87:"application/vnd.oasis.opendocument.text"===a.t1?88:"application/vnd.oasis.opendocument.spreadsheet"===a.t1?89:"application/vnd.oasis.opendocument.presentation"===a.t1?90:91;break;case 87:return a.abrupt("return",{ext:"epub",mime:"application/epub+zip"});case 88:return a.abrupt("return",{ext:"odt",mime:"application/vnd.oasis.opendocument.text"});case 89:return a.abrupt("return",{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"});case 90:return a.abrupt("return",{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"});case 91:return a.next=93,b.ignore(l.compressedSize);case 93:a.next=57;break;case 95:a.next=101;break;case 97:if(a.prev=97,a.t2=a["catch"](56),a.t2 instanceof strtok3.EndOfStreamError){a.next=101;break}throw a.t2;case 101:return a.abrupt("return",{ext:"zip",mime:"application/zip"});case 102:if(!f("OggS")){a.next=121;break}return a.next=105,b.ignore(28);case 105:return o=Buffer.alloc(8),a.next=108,b.readBuffer(o);case 108:if(!_check(o,[79,112,117,115,72,101,97,100])){a.next=110;break}return a.abrupt("return",{ext:"opus",mime:"audio/opus"});case 110:if(!_check(o,[128,116,104,101,111,114,97])){a.next=112;break}return a.abrupt("return",{ext:"ogv",mime:"video/ogg"});case 112:if(!_check(o,[1,118,105,100,101,111,0])){a.next=114;break}return a.abrupt("return",{ext:"ogm",mime:"video/ogg"});case 114:if(!_check(o,[127,70,76,65,67])){a.next=116;break}return a.abrupt("return",{ext:"oga",mime:"audio/ogg"});case 116:if(!_check(o,[83,112,101,101,120,32,32])){a.next=118;break}return a.abrupt("return",{ext:"spx",mime:"audio/ogg"});case 118:if(!_check(o,[1,118,111,114,98,105,115])){a.next=120;break}return a.abrupt("return",{ext:"ogg",mime:"audio/ogg"});case 120:return a.abrupt("return",{ext:"ogx",mime:"application/ogg"});case 121:if(!(e([80,75])&&(3===c[2]||5===c[2]||7===c[2])&&(4===c[3]||6===c[3]||8===c[3]))){a.next=123;break}return a.abrupt("return",{ext:"zip",mime:"application/zip"});case 123:if(!(f("ftyp",{offset:4})&&0!=(96&c[8])// Brand major, first character ASCII?
)){a.next=148;break}q=(0,_trim["default"])(p=uint8ArrayUtf8ByteString(c,8,12).replace("\0"," ")).call(p),a.t3=q,a.next="avif"===a.t3?128:"mif1"===a.t3?129:"msf1"===a.t3?130:"heic"===a.t3?131:"heix"===a.t3?131:"hevc"===a.t3?132:"hevx"===a.t3?132:"qt"===a.t3?133:"M4V"===a.t3?134:"M4VH"===a.t3?134:"M4VP"===a.t3?134:"M4P"===a.t3?135:"M4B"===a.t3?136:"M4A"===a.t3?137:"F4V"===a.t3?138:"F4P"===a.t3?139:"F4A"===a.t3?140:"F4B"===a.t3?141:"crx"===a.t3?142:143;break;case 128:return a.abrupt("return",{ext:"avif",mime:"image/avif"});case 129:return a.abrupt("return",{ext:"heic",mime:"image/heif"});case 130:return a.abrupt("return",{ext:"heic",mime:"image/heif-sequence"});case 131:return a.abrupt("return",{ext:"heic",mime:"image/heic"});case 132:return a.abrupt("return",{ext:"heic",mime:"image/heic-sequence"});case 133:return a.abrupt("return",{ext:"mov",mime:"video/quicktime"});case 134:return a.abrupt("return",{ext:"m4v",mime:"video/x-m4v"});case 135:return a.abrupt("return",{ext:"m4p",mime:"video/mp4"});case 136:return a.abrupt("return",{ext:"m4b",mime:"audio/mp4"});case 137:return a.abrupt("return",{ext:"m4a",mime:"audio/x-m4a"});case 138:return a.abrupt("return",{ext:"f4v",mime:"video/mp4"});case 139:return a.abrupt("return",{ext:"f4p",mime:"video/mp4"});case 140:return a.abrupt("return",{ext:"f4a",mime:"audio/mp4"});case 141:return a.abrupt("return",{ext:"f4b",mime:"audio/mp4"});case 142:return a.abrupt("return",{ext:"cr3",mime:"image/x-canon-cr3"});case 143:if(!(0,_startsWith["default"])(q).call(q,"3g")){a.next=147;break}if(!(0,_startsWith["default"])(q).call(q,"3g2")){a.next=146;break}return a.abrupt("return",{ext:"3g2",mime:"video/3gpp2"});case 146:return a.abrupt("return",{ext:"3gp",mime:"video/3gpp"});case 147:return a.abrupt("return",{ext:"mp4",mime:"video/mp4"});case 148:if(!f("MThd")){a.next=150;break}return a.abrupt("return",{ext:"mid",mime:"audio/midi"});case 150:if(!(f("wOFF")&&(e([0,1,0,0],{offset:4})||f("OTTO",{offset:4})))){a.next=152;break}return a.abrupt("return",{ext:"woff",mime:"font/woff"});case 152:if(!(f("wOF2")&&(e([0,1,0,0],{offset:4})||f("OTTO",{offset:4})))){a.next=154;break}return a.abrupt("return",{ext:"woff2",mime:"font/woff2"});case 154:if(!(e([212,195,178,161])||e([161,178,195,212]))){a.next=156;break}return a.abrupt("return",{ext:"pcap",mime:"application/vnd.tcpdump.pcap"});case 156:if(!f("DSD ")){a.next=158;break}return a.abrupt("return",{ext:"dsf",mime:"audio/x-dsf"// Non-standard
});case 158:if(!f("LZIP")){a.next=160;break}return a.abrupt("return",{ext:"lz",mime:"application/x-lzip"});case 160:if(!f("fLaC")){a.next=162;break}return a.abrupt("return",{ext:"flac",mime:"audio/x-flac"});case 162:if(!e([66,80,71,251])){a.next=164;break}return a.abrupt("return",{ext:"bpg",mime:"image/bpg"});case 164:if(!f("wvpk")){a.next=166;break}return a.abrupt("return",{ext:"wv",mime:"audio/wavpack"});case 166:if(!f("%PDF")){a.next=173;break}return a.next=169,g("Adobe Illustrator",1350);case 169:if(r=a.sent,!r){a.next=172;break}return a.abrupt("return",{ext:"ai",mime:"application/postscript"});case 172:return a.abrupt("return",{ext:"pdf",mime:"application/pdf"});case 173:if(!e([0,97,115,109])){a.next=175;break}return a.abrupt("return",{ext:"wasm",mime:"application/wasm"});case 175:if(!e([73,73,42,0])){a.next=188;break}if(!f("CR",{offset:8})){a.next=178;break}return a.abrupt("return",{ext:"cr2",mime:"image/x-canon-cr2"});case 178:if(!(e([28,0,254,0],{offset:8})||e([31,0,11,0],{offset:8}))){a.next=180;break}return a.abrupt("return",{ext:"nef",mime:"image/x-nikon-nef"});case 180:if(!(e([8,0,0,0],{offset:4})&&(e([45,0,254,0],{offset:8})||e([39,0,254,0],{offset:8})))){a.next=182;break}return a.abrupt("return",{ext:"dng",mime:"image/x-adobe-dng"});case 182:return c=Buffer.alloc(24),a.next=185,b.peekBuffer(c);case 185:if(!((e([16,251,134,1],{offset:4})||e([8,0,0,0],{offset:4}))&&// This pattern differentiates ARW from other TIFF-ish file types:
e([0,254,0,4,0,1,0,0,0,1,0,0,0,3,1],{offset:9}))){a.next=187;break}return a.abrupt("return",{ext:"arw",mime:"image/x-sony-arw"});case 187:return a.abrupt("return",{ext:"tif",mime:"image/tiff"});case 188:if(!e([77,77,0,42])){a.next=190;break}return a.abrupt("return",{ext:"tif",mime:"image/tiff"});case 190:if(!f("MAC ")){a.next=192;break}return a.abrupt("return",{ext:"ape",mime:"audio/ape"});case 192:if(!e([26,69,223,163])){a.next=208;break}return s=/*#__PURE__*/function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(){var c,d,e,f;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,b.peekNumber(Token.UINT8);case 2:// 0 = A, 1 = B, 2 = C, 3 = D
for(c=a.sent,d=128,e=0;0==(c&d);)++e,d>>=1;return f=Buffer.alloc(e+1),a.next=9,b.readBuffer(f);case 9:return a.abrupt("return",f);case 10:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}(),t=/*#__PURE__*/function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(){var b,c,d;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,s();case 2:return b=a.sent,a.next=5,s();case 5:return c=a.sent,c[0]^=128>>c.length-1,d=G(6,c.length),a.abrupt("return",{id:b.readUIntBE(0,b.length),len:c.readUIntBE(c.length-d,d)});case 9:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}(),u=/*#__PURE__*/function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(c,d){var f;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!(0<d)){a.next=11;break}return a.next=3,t();case 3:if(f=a.sent,17026!==f.id){a.next=6;break}return a.abrupt("return",b.readToken(new Token.StringType(f.len,"utf-8")));case 6:return a.next=8,b.ignore(f.len);case 8:--d,a.next=0;break;case 11:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}(),a.next=198,t();case 198:return v=a.sent,a.next=201,u(1,v.len);case 201:w=a.sent,a.t4=w,a.next="webm"===a.t4?205:"matroska"===a.t4?206:207;break;case 205:return a.abrupt("return",{ext:"webm",mime:"video/webm"});case 206:return a.abrupt("return",{ext:"mkv",mime:"video/x-matroska"});case 207:return a.abrupt("return");case 208:if(!e([82,73,70,70])){a.next=215;break}if(!e([65,86,73],{offset:8})){a.next=211;break}return a.abrupt("return",{ext:"avi",mime:"video/vnd.avi"});case 211:if(!e([87,65,86,69],{offset:8})){a.next=213;break}return a.abrupt("return",{ext:"wav",mime:"audio/vnd.wave"});case 213:if(!e([81,76,67,77],{offset:8})){a.next=215;break}return a.abrupt("return",{ext:"qcp",mime:"audio/qcelp"});case 215:if(!f("SQLi")){a.next=217;break}return a.abrupt("return",{ext:"sqlite",mime:"application/x-sqlite3"});case 217:if(!e([78,69,83,26])){a.next=219;break}return a.abrupt("return",{ext:"nes",mime:"application/x-nintendo-nes-rom"});case 219:if(!f("Cr24")){a.next=221;break}return a.abrupt("return",{ext:"crx",mime:"application/x-google-chrome-extension"});case 221:if(!(f("MSCF")||f("ISc("))){a.next=223;break}return a.abrupt("return",{ext:"cab",mime:"application/vnd.ms-cab-compressed"});case 223:if(!e([237,171,238,219])){a.next=225;break}return a.abrupt("return",{ext:"rpm",mime:"application/x-rpm"});case 225:if(!e([79,84,84,79,0])){a.next=227;break}return a.abrupt("return",{ext:"otf",mime:"font/otf"});case 227:if(!f("#!AMR")){a.next=229;break}return a.abrupt("return",{ext:"amr",mime:"audio/amr"});case 229:if(!f("{\\rtf")){a.next=231;break}return a.abrupt("return",{ext:"rtf",mime:"application/rtf"});case 231:if(!e([70,76,86,1])){a.next=233;break}return a.abrupt("return",{ext:"flv",mime:"video/x-flv"});case 233:if(!f("IMPM")){a.next=235;break}return a.abrupt("return",{ext:"it",mime:"audio/x-it"});case 235:if(!e([0,0,1,186])){a.next=240;break}if(!e([33],{offset:4,mask:[241]})){a.next=238;break}return a.abrupt("return",{ext:"mpg",// May also be .ps, .mpeg
mime:"video/MP1S"});case 238:if(!e([68],{offset:4,mask:[196]})){a.next=240;break}return a.abrupt("return",{ext:"mpg",// May also be .mpg, .m2p, .vob or .sub
mime:"video/MP2P"});case 240:if(!e([253,55,122,88,90,0])){a.next=242;break}return a.abrupt("return",{ext:"xz",mime:"application/x-xz"});case 242:if(!f("<?xml ")){a.next=244;break}return a.abrupt("return",{ext:"xml",mime:"application/xml"});case 244:if(!f("BEGIN:")){a.next=246;break}return a.abrupt("return",{ext:"ics",mime:"text/calendar"});case 246:if(!e([55,122,188,175,39,28])){a.next=248;break}return a.abrupt("return",{ext:"7z",mime:"application/x-7z-compressed"});case 248:if(!(e([82,97,114,33,26,7])&&(0===c[6]||1===c[6]))){a.next=250;break}return a.abrupt("return",{ext:"rar",mime:"application/x-rar-compressed"});case 250:if(!f("BLENDER")){a.next=252;break}return a.abrupt("return",{ext:"blend",mime:"application/x-blender"});case 252:if(!f("!<arch>")){a.next=261;break}return a.next=255,b.ignore(8);case 255:return a.next=257,b.readToken(new Token.StringType(13,"ascii"));case 257:if(x=a.sent,"debian-binary"!==x){a.next=260;break}return a.abrupt("return",{ext:"deb",mime:"application/x-deb"});case 260:return a.abrupt("return",{ext:"ar",mime:"application/x-unix-archive"});case 261:if(!e([137,80,78,71,13,10,26,10])){a.next=277;break}return y=/*#__PURE__*/function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(){return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,b.readToken(Token.INT32_BE);case 2:return a.t0=a.sent,a.next=5,b.readToken(new Token.StringType(4,"binary"));case 5:return a.t1=a.sent,a.abrupt("return",{length:a.t0,type:a.t1});case 7:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}(),a.next=265,b.ignore(8);case 265:return a.next=267,y();case 267:z=a.sent,a.t5=z.type,a.next="IDAT"===a.t5?271:"acTL"===a.t5?272:273;break;case 271:return a.abrupt("return",{ext:"png",mime:"image/png"});case 272:return a.abrupt("return",{ext:"apng",mime:"image/apng"});case 273:return a.next=275,b.ignore(z.length+4);case 275:if(b.position<b.fileInfo.size){a.next=265;break}case 276:return a.abrupt("return",{ext:"png",mime:"image/png"});case 277:if(!e([65,82,82,79,87,49,0,0])){a.next=279;break}return a.abrupt("return",{ext:"arrow",mime:"application/x-apache-arrow"});case 279:if(!e([103,108,84,70,2,0,0,0])){a.next=281;break}return a.abrupt("return",{ext:"glb",mime:"model/gltf-binary"});case 281:if(!(e([102,114,101,101],{offset:4})||// `free`
e([109,100,97,116],{offset:4})||// `mdat` MJPEG
e([109,111,111,118],{offset:4})||// `moov`
e([119,105,100,101],{offset:4})// `wide`
)){a.next=283;break}return a.abrupt("return",{ext:"mov",mime:"video/quicktime"});case 283:if(!e([73,73,82,79,8,0,0,0,24])){a.next=285;break}return a.abrupt("return",{ext:"orf",mime:"image/x-olympus-orf"});case 285:if(!e([73,73,85,0,24,0,0,0,136,231,116,216])){a.next=287;break}return a.abrupt("return",{ext:"rw2",mime:"image/x-panasonic-rw2"});case 287:if(!e([48,38,178,117,142,102,207,17,166,217])){a.next=312;break}return A=/*#__PURE__*/function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(){var c;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c=Buffer.alloc(16),a.next=3,b.readBuffer(c);case 3:return a.t0=c,a.next=6,b.readToken(Token.UINT64_LE);case 6:return a.t1=a.sent,a.abrupt("return",{id:a.t0,size:a.t1});case 8:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}(),a.next=291,b.ignore(30);case 291:if(!(b.position+24<b.fileInfo.size)){a.next=311;break}return a.next=294,A();case 294:if(B=a.sent,C=B.size-24,!_check(B.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){a.next=307;break}return D=Buffer.alloc(16),a.t6=C,a.next=301,b.readBuffer(D);case 301:if(C=a.t6-=a.sent,!_check(D,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43])){a.next=304;break}return a.abrupt("return",{ext:"wma",mime:"audio/x-ms-wma"});case 304:if(!_check(D,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43])){a.next=306;break}return a.abrupt("return",{ext:"wmv",mime:"video/x-ms-asf"});case 306:return a.abrupt("break",311);case 307:return a.next=309,b.ignore(C);case 309:a.next=291;break;case 311:return a.abrupt("return",{ext:"asf",mime:"application/vnd.ms-asf"});case 312:if(!e([171,75,84,88,32,49,49,187,13,10,26,10])){a.next=314;break}return a.abrupt("return",{ext:"ktx",mime:"image/ktx"});case 314:if(!((e([126,16,4])||e([126,24,4]))&&e([48,77,73,69],{offset:4}))){a.next=316;break}return a.abrupt("return",{ext:"mie",mime:"application/x-mie"});case 316:if(!e([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2})){a.next=318;break}return a.abrupt("return",{ext:"shp",mime:"application/x-esri-shape"});case 318:if(!e([0,0,0,12,106,80,32,32,13,10,135,10])){a.next=332;break}return a.next=321,b.ignore(20);case 321:return a.next=323,b.readToken(new Token.StringType(4,"ascii"));case 323:E=a.sent,a.t7=E,a.next="jp2 "===a.t7?327:"jpx "===a.t7?328:"jpm "===a.t7?329:"mjp2"===a.t7?330:331;break;case 327:return a.abrupt("return",{ext:"jp2",mime:"image/jp2"});case 328:return a.abrupt("return",{ext:"jpx",mime:"image/jpx"});case 329:return a.abrupt("return",{ext:"jpm",mime:"image/jpm"});case 330:return a.abrupt("return",{ext:"mj2",mime:"image/mj2"});case 331:return a.abrupt("return");case 332:if(!(e([0,0,1,186])||e([0,0,1,179]))){a.next=334;break}return a.abrupt("return",{ext:"mpg",mime:"video/mpeg"});case 334:if(!e([0,1,0,0,0])){a.next=336;break}return a.abrupt("return",{ext:"ttf",mime:"font/ttf"});case 336:if(!e([0,0,1,0])){a.next=338;break}return a.abrupt("return",{ext:"ico",mime:"image/x-icon"});case 338:if(!e([0,0,2,0])){a.next=340;break}return a.abrupt("return",{ext:"cur",mime:"image/x-icon"});case 340:return a.next=342,b.peekBuffer(c,{length:G(256,b.fileInfo.size),mayBeLess:!0});case 342:if(!f("FUJIFILMCCD-RAW")){a.next=344;break}return a.abrupt("return",{ext:"raf",mime:"image/x-fujifilm-raf"});case 344:if(!f("Extended Module:")){a.next=346;break}return a.abrupt("return",{ext:"xm",mime:"audio/x-xm"});case 346:if(!f("Creative Voice File")){a.next=348;break}return a.abrupt("return",{ext:"voc",mime:"audio/x-voc"});case 348:if(!(e([48,48,48,48,48,48],{offset:148,mask:[248,248,248,248,248,248]})&&// Valid tar checksum
tarHeaderChecksumMatches(c))){a.next=350;break}return a.abrupt("return",{ext:"tar",mime:"application/x-tar"});case 350:if(!e([208,207,17,224,161,177,26,225,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,62])){a.next=352;break}return a.abrupt("return",{ext:"msi",mime:"application/x-msi"});case 352:if(!e([6,14,43,52,2,5,1,1,13,1,2,1,1,2])){a.next=354;break}return a.abrupt("return",{ext:"mxf",mime:"application/mxf"});case 354:if(!f("SCRM",{offset:44})){a.next=356;break}return a.abrupt("return",{ext:"s3m",mime:"audio/x-s3m"});case 356:if(!(e([71],{offset:4})&&(e([71],{offset:192})||e([71],{offset:196})))){a.next=358;break}return a.abrupt("return",{ext:"mts",mime:"video/mp2t"});case 358:if(!e([66,79,79,75,77,79,66,73],{offset:60})){a.next=360;break}return a.abrupt("return",{ext:"mobi",mime:"application/x-mobipocket-ebook"});case 360:if(!e([68,73,67,77],{offset:128})){a.next=362;break}return a.abrupt("return",{ext:"dcm",mime:"application/dicom"});case 362:if(!e([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70])){a.next=364;break}return a.abrupt("return",{ext:"lnk",mime:"application/x.ms.shortcut"// Invented by us
});case 364:if(!e([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0])){a.next=366;break}return a.abrupt("return",{ext:"alias",mime:"application/x.apple.alias"// Invented by us
});case 366:if(!(e([76,80],{offset:34})&&(e([0,0,1],{offset:8})||e([1,0,2],{offset:8})||e([2,0,2],{offset:8})))){a.next=368;break}return a.abrupt("return",{ext:"eot",mime:"application/vnd.ms-fontobject"});case 368:return a.next=370,b.peekBuffer(c,{length:G(512,b.fileInfo.size),mayBeLess:!0});case 370:if(!(e([48,48,48,48,48,48],{offset:148,mask:[248,248,248,248,248,248]})&&// Valid tar checksum
tarHeaderChecksumMatches(c))){a.next=372;break}return a.abrupt("return",{ext:"tar",mime:"application/x-tar"});case 372:if(!e([255,254,255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0])){a.next=374;break}return a.abrupt("return",{ext:"skp",mime:"application/vnd.sketchup.skp"});case 374:F=0;case 375:if(!(2>F&&F<c.length-16)){a.next=390;break}if(!(c.length>=F+2&&e([255,224],{offset:F,mask:[255,224]}))){a.next=387;break}if(!e([16],{offset:F+1,mask:[22]})){a.next=381;break}if(!e([8],{offset:F+1,mask:[8]})){a.next=380;break}return a.abrupt("return",{ext:"aac",mime:"audio/aac"});case 380:return a.abrupt("return",{ext:"aac",mime:"audio/aac"});case 381:if(!e([2],{offset:F+1,mask:[6]})){a.next=383;break}return a.abrupt("return",{ext:"mp3",mime:"audio/mpeg"});case 383:if(!e([4],{offset:F+1,mask:[6]})){a.next=385;break}return a.abrupt("return",{ext:"mp2",mime:"audio/mpeg"});case 385:if(!e([6],{offset:F+1,mask:[6]})){a.next=387;break}return a.abrupt("return",{ext:"mp1",mime:"audio/mpeg"});case 387:F++,a.next=375;break;case 390:case"end":return a.stop();}},a,null,[[56,97]])})),_fromTokenizer3.apply(this,arguments)}var stream=function(readableStream){return new _promise["default"](function(resolve,reject){// Using `eval` to work around issues when bundling with Webpack
var stream=eval("require")("stream");// eslint-disable-line no-eval
readableStream.on("error",reject),readableStream.once("readable",/*#__PURE__*/(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(){var b,c,d,e;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b=new stream.PassThrough,c=stream.pipeline?stream.pipeline(readableStream,b,function(){}):readableStream.pipe(b),d=readableStream.read(minimumBytes)||readableStream.read()||Buffer.alloc(0),a.prev=3,a.next=6,fromBuffer(d);case 6:e=a.sent,b.fileType=e,a.next=13;break;case 10:a.prev=10,a.t0=a["catch"](3),reject(a.t0);case 13:resolve(c);case 14:case"end":return a.stop();}},a,null,[[3,10]])})))})},fileType={fromStream:fromStream,fromTokenizer:fromTokenizer,fromBuffer:fromBuffer,stream:stream};(0,_defineProperty2["default"])(fileType,"extensions",{get:function get(){return new _set["default"](supported.extensions)}}),(0,_defineProperty2["default"])(fileType,"mimeTypes",{get:function get(){return new _set["default"](supported.mimeTypes)}}),module.exports=fileType;